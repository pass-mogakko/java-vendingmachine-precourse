# [미션 - 자판기] 명세서

## 목차

1. [기능 목록](#-기능-목록)
2. [상수값 목록](#-상수값-목록)
3. [단위 테스트 목록](#-단위테스트-목록)
4. [클래스 설계](#-클래스-설계)
5. [리팩토링 검토 목록](#%EF%B8%8F-리팩토링-검토-목록)

## 🚀 기능 목록

### 로직 분리에 따른 예외 발생 기준

- 예외 발생 시 적합한 표준예외를 사용한다.
- 기본 UI 검증 오류는 `view`에서, 도메인 기능에서 발생하는 오류는 `service`에서 예외를 발생시킨다.

### 도메인 구성 요소

- 동전 (500, 100, 50, 10)
- 자판기
    - 보유한 동전 목록 (동전 종류, 개수)
    - 보유 상품 목록 (상품, 개수)
    - 잔돈 금액 (투입받은 금액의 현재 잔액)
- 상품
    - 이름
    - 가격 : 100원부터 시작, 10원으로 나누어 떨어져야 한다.
- 잔돈 동전 목록 (동전 종류, 개수)

### 도메인 로직을 위한 기능

1.
    - [x] (자판기 설정) 전달받은 보유 금액에 따라 자판기에 동전을 생성하는 기능
        - [x] `예외발생` : 보유 금액이 0보다 작은 경우
        - [x] `예외발생` : 보유 금액이 10의 배수가 아닌 경우
2.
    - [x] (자판기 설정) 전달받은 상품 목록을 자판기에 저장하는 기능
        - [x] `예외발생` : 상품 가격이 10의 배수가 아닌 경우
        - [x] `예외발생` : 상품 가격이 100원 미만인 경우
        - [x] `예외발생` : 상품 수량이 0보다 작은 경우
        - [x] `예외발생` : 모든 상품 수량의 총 합이 0인 경우
3.
    - [x] (자판기 설정) 전달받은 투입 금액을 자판기의 잔돈 금액 정보에 저장하는 기능
        - [x] `예외발생` : 투입 금액이 0 이하인 경우
        - [x] `예외발생` : 투입 금액이 10의 배수가 아닌 경우
        - [x] `예외발생` : 투입 금액이 상품 최저 금액보다 작은 경우
4.
    - [x] (상품 구매) 구매하는 상품의 수량, 자판기의 투입 금액을 변경하는 기능
    - 상품명에 해당하는 상품의 수량에서 1을 빼고, 잔돈에서 상품의 금액만큼을 뺀다.
        - [x] `예외발생` : 전달받은 상품명을 가진 상품이 존재하지 않는 경우
        - [x] `예외발생` : 전달받은 상품명을 가진 상품의 수량이 0인 경우
5.
    - [x] (상품 구매) 자판기의 판매 가능 상태를 확인하는 기능
    - 남은 투입 금액이 상품 최저 가격보다 적거나, 모든 상품이 소진되었는지 확인
6.
    - [x] (잔돈 반환) 잔돈을 돌려주기 위해 사용할 동전 별 개수를 계산해 반환하는 기능
    - 잔돈 금액보다 보유 동전의 총액이 더 크거나 같은 경우 : 보유한 동전을 최소한으로 사용하여, 잔돈 금액에 가장 가까운 금액을 만드는 동전 별 개수를 계산
    - 잔돈 금액보다 보유 동전의 총액이 더 작을 경우 : 보유한 동전의 개수를 모두 계산 (가진 동전을 모두 반환)
    - 보유한 동전이 하나도 없으면 0개를 반환

### UI 로직을 위한 기능

1.
    - [x] 자판기 보유 금액을 입력받는 기능
        - [x] `예외발생` : 0 또는 자연수가 아닌 경우
2.
    - [x] 자판기 보유 동전 목록을 출력하는 기능
3.
    - [x] 상품명, 가격, 수량을 형식에 맞게 입력받는 기능
        - [x] `예외발생` : 형식에 맞지 않는 경우(띄어쓰기까지 검증)
        - [x] `예외발생` : 상품명이 공백이나 빈 문자열인 경우
        - [x] `예외발생` : 중복된 상품명이 있는 경우
        - [x] `예외발생` : 가격이 0 또는 자연수가 아닌 경우
        - [x] `예외발생` : 수량이 0 또는 자연수가 아닌 경우
4.
    - [x] 투입 금액을 입력받는 기능
        - [x] `예외발생` : 0 또는 자연수가 아닌 경우
5.
    - [x] 투입 금액을 출력하는 기능
6.
    - [x] 추가 구매가 가능할 때까지 계속해서 구매할 상품명을 입력받는 기능
        - [x] `예외발생` : 공백 또는 빈 문자열인 경우
7.
    - [x] 잔돈 동전 목록을 출력하는 기능
    - 0개인 동전은 출력하지 않는다.
    - 잔돈으로 반환한 동전의 총 개수가 0개이면 안내 메시지를 출력한다.
8.
    - [x] 에러 메시지를 형식에 맞게 출력하는 기능
9.
    - [x] 잘못된 값을 입력하면 정해진 처리 로직을 수행하고 해당 부분부터 재입력받는 기능

## 🗄 상수값 목록

### 도메인 로직 정보

- [x] 동전의 종류, 금액
- [x] 에러 메시지

### UI 로직 정보

- [x] 입력 형식
- [x] 입력 안내 메시지
- [x] 출력 형식
- [x] 에러 메시지

## ✅ 단위테스트 목록

### 도메인 로직 단위테스트

- [x] 기능1 단위테스트 : (자판기 설정) 동전 생성
    - [x] 동전 생성 성공 (0개인 경우도 목록에 저장)
    - [x] 동전 생성 보유금액 10의 배수가 아니면 예외발생
    - [x] 동전 생성 보유금액 음수이면 예외발생
- [x] 기능2 단위테스트 : (자판기 설정) 상품 목록 저장
    - [x] 상품 정보 생성_가격이 10의 배수가 아니면 예외 발생
    - [x] 상품 정보 생성_가격이 100원 미만이면 예외 발생
    - [x] 상품 목록 생성_음수인 상품 수량 정보가 존재하면 예외 발생
    - [x] 상품 목록 저장_모든 상품 수량의 총 합이 0인 경우 예외 발생
- [x] 기능3 단위테스트 : (자판기 설정) 투입 금액 저장
    - [x] 투입 금액 저장 성공
    - [x] 투입 금액 저장_투입 금액이 0 이하이면 예외 발생
    - [x] 투입 금액 저장_투입 금액이 10의 배수가 아니면 예외 발생
    - [x] 투입 금액 저장_투입 금액이 상품 최저 금액보다 작으면 예외 발생
- [x] 기능4 단위테스트 : (상품 구매) 상품 개수, 투입 금액 변경
    - [x] 상품 구매_성공
    - [x] 상품 구매_존재하지 않는 상품명이면 예외 발생
    - [x] 상품 구매_상품의 수량이 0이면 예외 발생
- [x] 기능5 단위테스트 : (상품 구매) 자판기의 구매 가능 상태 확인
    - [x] 구매 가능 확인_참
    - [x] 구매 가능 확인_남은 투입 금액이 상품 최저 가격보다 작으면 거짓
    - [x] 구매 가능 확인_남은 상품 수량이 0이면 거짓
- [x] 기능6 단위테스트 : (잔돈 반환) 잔돈의 동전 별 개수를 계산해 반환
    - [x] 잔돈 반환_성공

## 🖋 클래스 설계

(상수 관련 클래스는 생략함)

- controller
    - VendingMachineController
        - 프로그램 진행 순서에 맞게 model 로직과 view 로직을 중재하는 클래스
    - util
        - InputErrorInterceptor
            - 잘못된 값 입력에 대한 예외 발생 시 해당 부분부터 다시 실행하도록 하는 클래스

- model
    - Coin
        - 동전 하나의 이름과 값을 나타내는 Enum 클래스
    - Item
        - 상품 하나의 이름, 가격, 수량을 나타내는 클래스
    - MachineCoinsMaker
        - 전달받은 금액을 이용해 생성한 동전 목록을 생성하는 클래스
    - MachineCoins
        - 자판기가 보유한 동전 목록을 가지는 일급 콜렉션 클래스
        - MachineCoinsMaker 객체를 주입받아 생성한다.
    - MachineItems
        - 자판기가 보유한 상품 목록을 가지는 일급 콜렉션 클래스
        - 상품 저장, 수량 변경, 상품 금액 확인의 기능을 제공한다.
    - ChangeCoins
        - 자판기가 반환할 동전 목록을 가지는 일급 콜렉션 클래스
        - 전달받은 동전 목록, 잔돈 금액을 이용해 반환할 동전 목록을 생성한다.
    - VendingMachine
        - 자판기 기능을 수행하는 클래스
        - MachineItems, MachineCoins 객체와 "잔돈 금액"을 멤버 변수로 관리한다.
        - 상품 구매 시 MachineItems, "잔돈 금액"의 상태를 변경한다.
        - MachineItems, "잔돈 금액"의 상태에 따라 상품 구매 반복 여부를 결정한다.
        - 잔돈 반환 시 MachineCoins, "잔돈 금액"을 이용해 ChangeCoins 객체를 생성해 반환한다.

- view
    - OutputView
        - 결과 안내 관련 상호작용 담당
    - InputView
        - 사용자 입력값 상호작용 담당

## ♻️ 리팩토링 검토 목록

### 코드 스타일 및 요구사항

- [ ] 인덴트 2 이하 검토
- [ ] 메소드 분리 검토
- [ ] 메소드 길이 10라인 이하 검토
- [ ] 파라미터 개수 3개 이하 검토
- [ ] 변수, 메소드 선언 순서 정리 (메소드 정렬 기준 1순위: 메소드 간 논리적 연관성, 2순위: public-private)
- [ ] Java 코드 컨벤션 가이드 준수 검토
- [ ] 요구사항에 주어진 클래스 적용 규칙 검토
- [ ] TODO 주석 모두 해결 후 삭제
- [ ] 클래스 주석 작성